#!/bin/bash

set -eo pipefail

{{- if .onepassword_available }}
# Verify 1Password CLI is working
if ! op account list &>/dev/null; then
  echo "Please sign in to 1Password..."
  op signin || {
    echo "❌ Failed to sign in to 1Password"
    echo "   Run 'op signin' manually when ready"
    exit 1
  }
fi

echo "✅ 1Password CLI configured and authenticated"

# Set up SSH agent integration
if [ ! -d "~/Library/Group Containers/2BUA8C4S2C.com.1password" ]; then
  echo "⚠️  1Password app not detected"
  echo "   Please install 1Password app and enable SSH agent in Settings > Developer"
fi
{{- else }}
echo "⏭️  1Password not available, skipping 1Password setup"
{{- end }}
