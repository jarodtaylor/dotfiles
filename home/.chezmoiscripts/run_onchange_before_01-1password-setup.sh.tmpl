#!/bin/bash

set -eo pipefail

# Check if 1Password CLI is installed
if ! command -v op &>/dev/null; then
  echo "Error: 1Password CLI is not installed."
  echo "Please make sure it was added to your brew packages list and run 'chezmoi apply' to install all required packages."
  exit 1
fi

# Check if already signed in
if ! op account list &>/dev/null; then
  echo "1Password CLI needs to be signed in."
  echo "Please run: op signin"
  echo "You'll need your account address, email, and Secret Key."
  echo "You can find these in your 1Password account settings."
  exit 1
fi

# Verify we can read from 1Password
if ! op item list &>/dev/null; then
  echo "Error: Cannot read from 1Password. Please ensure you're signed in."
  exit 1
fi

echo "1Password CLI setup complete." 